#!/usr/bin/bash

RESOURCE_GROUP=$1
SSH_KEY=$2
KUBECONFIG_LOCATION=$3
SSH_OPT="-oStrictHostKeyChecking=no"

if [[ -z "$KUBECONFIG_LOCATION" ]]; then
    KUBECONFIG_LOCATION="/home/mjudeiki/.aos/"
	echo $KUBECONFIG_LOCATION
fi
mkdir -p $KUBECONFIG_LOCATION

if [[ -z "$RESOURCE_GROUP" ]]; then
    RESOURCE_GROUP=cluster_name
	echo $RESOURCE_GROUP
fi

if [[ -z "$SSH_KEY" ]]; then
    SSH_KEY=${GOPATH}/src/github.com/Azure/acs-engine/_output/$RESOURCE_GROUP-ssh
    echo $SSH_KEY  
fi

IP=$(az network public-ip  list --resource-group $RESOURCE_GROUP --query "[?starts_with(name, 'ocp-master')].ipAddress" 2>/dev/null | jq -r '.[]')

#get kubeconfig
ssh -i $SSH_KEY $SSH_OPT cloud-user@$IP "mkdir -p ~/.kube; sudo cp /root/.kube/config /home/cloud-user/.kube/config ; sudo chown cloud-user:cloud-user /home/cloud-user/.kube/config"
scp -i $SSH_KEY $SSH_OPT cloud-user@$IP:/home/cloud-user/.kube/config ${KUBECONFIG_LOCATION}hcl_dev.kubeconfig

echo "oc --config ${KUBECONFIG_LOCATION}hcl_dev.kubeconfig get pods"